# Служба опроса пользователей

API для системы опросов пользователей

## Функционал для администратора системы

- авторизация в системе (регистрация не нужна)
- добавление/изменение/удаление опросов. Атрибуты опроса: название, дата старта, дата окончания, описание. После создания поле "дата старта" у опроса менять нельзя
- добавление/изменение/удаление вопросов в опросе. Атрибуты вопросов: текст вопроса, тип вопроса (ответ текстом, ответ с выбором одного варианта, ответ с выбором нескольких вариантов)

## Функционал для пользователей системы

- получение списка активных опросов
- прохождение опроса: опросы можно проходить анонимно, в качестве идентификатора пользователя в API передаётся числовой ID, по которому сохраняются ответы пользователя на вопросы; один пользователь может участвовать в любом количестве опросов
- получение пройденных пользователем опросов с детализацией по ответам (что выбрано) по ID уникальному пользователя

## Запуск

Запустить сервис можно следующими способами:
1) Для запуска через docker compose необходимо использовать команду:

```sh
docker-compose up --build -d poll1
```

2) Для запуска с использованием python 3.9:

```sh
pip install --upgrade pip
pip install -r requirements.txt
python manage.py runserver 0.0.0.0:8000
```

## Схема
При работе с API необходимо использовать версию v1. Запросы необходимо отправлять по адресу:

```sh
127.0.0.1:8000/api/v1/
```

Ответ формируется в JSON-формате.

Данные типа «Дата» указываются в формате Y-m-d (например 2014-03-21), данные типа «Дата/время» — в формате Y-m-d H:M:S (например 2014-03-21 05:14:07).

## Авторизация
Авторизация производится с помощью токена, который передается через заголовок:
`Authorization: Token cd6233f7fd39f6432372a09e69d5b4d37571667a`
Для получения токена нужно направить `POST` запрос по адресу:
```sh
127.0.0.1:8000/api/v1/auth/token/login/
```
Запрос должен содержать поля `"username"` и `"password"` в формате `x-form`
По умолчанию Администратор имеет следующие учетные данные:
`"username" = admin`
`"password" = 123`
В ответе получаем токен авторизации:
```json
{"auth_token":"cd6233f7fd39f6432372a09e69d5b4d37571667a"}
```
## Справочник методов 
### 1. Получение списка опросов
| `GET` | `api/v1/polls/` |
|---|---|
Возвращает JSON со списком опросов
#### Функционал пользователя
Получение списка активных опросов. Активным считается опрос, дата завершения которого еще не наступила.
#### Функционал администратора
Получение списка всех опросов.
#### Параметры запроса
Отсутствуют
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `id` | `Int`  | Уникальный номер опроса  |  |
| `title` | `Char`  | Название |Максимальная длина 50 символов|  
| `description` | `Char`  | Описание опроса  |  |
| `started_at` | `Date`  | Дата старта  | Формируется автоматически при создании опроса |  
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда|  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/
```
#### Пример ответа
```json
[
    {
        "id": 2,
        "title": "Тестовый опрос 2",
        "description": "Опрос для тестирования создания",
        "started_at": "2022-04-26",
        "finished_at": "2022-10-23"
    },
    {
        "id": 1,
        "title": "Тестовый опрос",
        "description": "Опрос для тестирования",
        "started_at": "2022-03-18",
        "finished_at": null
    }
]
```
### 2. Создание нового опроса
| `POST` | `api/v1/polls/` |
|---|---|
Создает новый опрос с уникальным id
Необходимы права администратора
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `title` | `Char`  | Название |Максимальная длина 50 символов|  Да |
| `description` | `Char`  | Описание опроса  |  |Нет |
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда|  Нет |
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `id` | `Int`  | Уникальный номер опроса  |  |
| `title` | `Char`  | Название |Максимальная длина 50 символов|  
| `description` | `Char`  | Описание опроса  |  |
| `started_at` | `Date`  | Дата старта  | Формируется автоматически при создании опроса |  
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда|  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/
```
```json
    {
        "title": "Тестовый опрос 2",
        "description": "Опрос для тестирования создания",
        "finished_at": "2022-10-23"
    }
```
#### Пример ответа
```json
{
    "id": 2,
    "title": "Тестовый опрос 2",
    "description": "Опрос для тестирования создания",
    "started_at": "2022-04-26",
    "finished_at": "2022-10-23"
}
```
### 3. Изменение опроса
| `PATCH` | `api/v1/polls/{poll_id}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
Необходимы права администратора
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `title` | `Char`  | Название |Максимальная длина 50 символов|  Нет |
| `description` | `Char`  | Описание опроса  |  |Нет |
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда|  Нет |
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `id` | `Int`  | Уникальный номер опроса  |  |
| `title` | `Char`  | Название |Максимальная длина 50 символов|  
| `description` | `Char`  | Описание опроса  |  |
| `started_at` | `Date`  | Дата старта  | Формируется автоматически при создании опроса |  
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда|  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/
```
```json
    {
        "description": "Опрос для тестирования изменения",
        "finished_at": "2022-10-11"
    }
```
#### Пример ответа
```json
{
    "id": 1,
    "title": "Тестовый опрос",
    "description": "Опрос для тестирования изменения",
    "started_at": "2022-03-18",
    "finished_at": "2022-10-11"
}
```
### 4. Удаление опроса
| `DELETE` | `api/v1/polls/{poll_id}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
Необходимы права администратора
#### Параметры запроса
Отсутствуют
#### Параметры ответа
Отсутствуют
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/2/
```
### 5. Получение детальной информации об опросе 
| `GET` | `api/v1/polls/{poll_id}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
#### Параметры запроса
Отсутствуют
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `id` | `Int`  | Уникальный номер опроса  |  |
| `title` | `Char`  | Название |Максимальная длина 50 символов|  
| `description` | `Char`  | Описание опроса  |  |
| `started_at` | `Date`  | Дата старта  | Формируется автоматически при создании опроса |  
| `finished_at` | `Date`  | Дата окончания   |Если не задано (`null`), то опрос активен всегда| 
| `questions` | `List(Question)`  | Список вопросов   |См. `Получение списка вопросов`| 
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/
```
#### Пример ответа
```json
{
    "id": 1,
    "title": "Тестовый опрос",
    "description": "Опрос для тестирования",
    "started_at": "2022-03-18",
    "finished_at": null,
    "questions": [
        {
            "position": 1,
            "question_type": "Ответ текстом",
            "main_text": "Сколько будет 2+2?",
            "choices": []
        },
        {
            "position": 2,
            "question_type": "Ответ с выбором одного варианта",
            "main_text": "Скольо будет 3*2?",
            "choices": [
                "5",
                "6",
                "7",
                "8"
            ]
        },
        {
            "position": 3,
            "question_type": "Ответ с выбором нескольких вариантов",
            "main_text": "Выберите нечетные числа",
            "choices": [
                "5",
                "6",
                "7",
                "8"
            ]
        }
    ]
}
```
### 6. Получение списка вопросов
| `GET` | `api/v1/polls/{poll_id}/questions/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
Необходимы права администратора
#### Параметры запроса
Отсутствуют
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |
| `main_text` | `Char`  | Текст вопроса  |  |
| `choices` | `List(Char)`  | Список вариантов ответа  | Для типа `Ответ текстом` список должен быть пустым, для типов  `Ответ с выбором одного варианта` и `Ответ с выбором нескольких вариантов` содержать не менее 2-х элементов|  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/questions/
```
#### Пример ответа
```json
[
    {
        "position": 1,
        "question_type": "Ответ текстом",
        "main_text": "Сколько будет 2+2?",
        "choices": []
    },
    {
        "position": 2,
        "question_type": "Ответ с выбором одного варианта",
        "main_text": "Скольо будет 3*2?",
        "choices": [
            "5",
            "6",
            "7",
            "8"
        ]
    },
    {
        "position": 3,
        "question_type": "Ответ с выбором нескольких вариантов",
        "main_text": "Выберите нечетные числа",
        "choices": [
            "5",
            "6",
            "7",
            "8"
        ]
    }
]
```
### 7. Создание нового вопроса
| `POST` | `api/v1/polls/{poll_id}/questions/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
Необходимы права администратора
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  | Да |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |  Да |
| `main_text` | `Char`  | Текст вопроса  |  | Да |
| `choices` | `List(Char)`  | Список вариантов ответа  | Список не пустой только для вопросов с выбором одного или нескольких ответов |  Да |
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |
| `main_text` | `Char`  | Текст вопроса  |  |
| `choices` | `List(Char)`  | Список вариантов ответа  | Список не пустой только для вопросов с выбором одного или нескольких ответов |  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/questions/
```
```json
{
    "position": 12,
    "question_type": "Ответ с выбором одного варианта",
    "main_text": "Скольо будет 3*2?",
    "choices": ["5", "6", "7", "8"]
}
```
#### Пример ответа
```json
{
    "position": 12,
    "question_type": "Ответ с выбором одного варианта",
    "main_text": "Скольо будет 3*2?",
    "choices": [
        "5",
        "6",
        "7",
        "8"
    ]
}
```
### 8. Изменение опроса
| `PATCH` | `api/v1/polls/{poll_id}/questions/{position}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
`{position}` - порядковый номер вопроса в опросе
Необходимы права администратора
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  | Нет |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |  Нет* |
| `main_text` | `Char`  | Текст вопроса  |  | Нет |
| `choices` | `List(Char)`  | Список вариантов ответа  | Список не пустой только для вопросов с выбором одного или нескольких ответов |  Нет* |
*Если меняется тип вопроса, необходимо также обновить список вариантов ответа.
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |
| `main_text` | `Char`  | Текст вопроса  |  |
| `choices` | `List(Char)`  | Список вариантов ответа  | Список не пустой только для вопросов с выбором одного или нескольких ответов |  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/
```
```json
    {
        "description": "Опрос для тестирования изменения",
        "finished_at": "2022-10-11"
    }
```
#### Пример ответа
```json
{
    "id": 1,
    "title": "Тестовый опрос",
    "description": "Опрос для тестирования изменения",
    "started_at": "2022-03-18",
    "finished_at": "2022-10-11"
}
```
### 9. Удаление вопроса
| `DELETE` | `api/v1/polls/{poll_id}/questions/{position}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
`{position}` - порядковый номер вопроса в опросе
Необходимы права администратора
#### Параметры запроса
Отсутствуют
#### Параметры ответа
Отсутствуют
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/questions/18/
```
### 10. Получение детальной информации о вопросе 
| `GET` | `api/v1/polls/{poll_id}/questions/{position}/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
`{position}` - порядковый номер вопроса в опросе
Необходимы права администратора
#### Параметры запроса
Отсутствуют
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе  |  |
| `question_type` | `Char`  | Тип вопроса | Возможные значения: 1 - `Ответ текстом`; 2 - `Ответ с выбором одного варианта`; 3 - `Ответ с выбором нескольких вариантов` |
| `main_text` | `Char`  | Текст вопроса  |  |
| `choices` | `List(Char)`  | Список вариантов ответа  | Список не пустой только для вопросов с выбором одного или нескольких ответов |  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/questions/2/
```
#### Пример ответа
```json
{
    "position": 2,
    "question_type": "Ответ с выбором одного варианта",
    "main_text": "Скольо будет 3*2?",
    "choices": [
        "5",
        "6",
        "7",
        "8"
    ]
}
```
### 11. Прохождение опроса
| `POST` | `api/v1/polls/{poll_id}/vote/` |
|---|---|
`{poll_id}` - Уникальный номер опроса
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `user` | `Int`  | Уникальный номер пользователя  | Если не указывать, то формируется автоматически | Нет |
| `answers` | `List(position, answer)`  | Список ответов (список словарей с ключами `position` и `answer`)* | Необходимо ответить на все вопросы |  Да |

*Ответ должен включать следующие параметры:
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `position` | `Int`  | Уникальный номер вопроса в опросе |  |Да |
| `answer` | `List(Char)`  | Список ответов | Для вопросов типа `Ответ текстом` и `Ответ с выбором одного варианта` список должен содержать один элемент, для типа `Ответ с выбором нескольких вариантов` список может содержать 1 и более элементов |  Да |

#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `id` | `Int`  | Уникальный номер попытки  |  |
| `user` | `Int`  | Уникальный номер пользователя  |  |
| `poll` | `Int`  | Уникальный номер опроса  |  |  
#### Пример запроса
```sh
127.0.0.1:8000/api/v1/polls/1/
```
```json
{
    "user": 3,
    "answers":
        [{"position": 1, "answer": ["4"]},
         {"position": 2, "answer": ["6"]},
         {"position": 3, "answer": ["5", "15"]}
        ]
}
```
#### Пример ответа
```json
{
    "id": 19,
    "user": 3,
    "poll": 1
}
```
### 12. Информация о пройденных опросах
| `POST` | `api/v1/results/` |
|---|---|
Возвращает список пройденных опросов
#### Параметры запроса
| Параметр | Тип  | Описание  |  Примечание | Обязательный параметр |
|---|---|---|---|---|
| `user` | `Int`  | Уникальный номер пользователя  |  | Да |
#### Параметры ответа
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `user` | `Int`  | Уникальный номер пользователя  |  |
| `time` | `Datetime`  | Время прохождения опроса  |  |  
| `poll` | `Poll`  | Информация об опросе  | см.[5. Получение детальной информации об опросе]  (#5-получение-детальной-информации-об-опросе)| 
| `answers` | `List(question, answer)`  | Список вопросов и ответов*  |  |  
*Список вопросов и ответов содержит следующие параметры:
| Параметр | Тип  | Описание  |  Примечание |
|---|---|---|---|
| `question` | `Question`  | Информация о вопросе  | см.[10. Получение детальной информации о вопросе]  (#10-получение-детальной-информации-о-вопросе)| 
| `answer` | `List(Char)`  | Список ответов | Для вопросов типа `Ответ текстом` и `Ответ с выбором одного варианта` список должен содержать один элемент, для типа `Ответ с выбором нескольких вариантов` список может содержать 1 и более элементов | 


#### Пример запроса
```sh
127.0.0.1:8000/api/v1/results/
```
```json
    {
        "user": 3
    }
```
#### Пример ответа
```json
[
    {
        "user": 3,
        "time": "2022-05-04 06:42:31",
        "poll": {
            "id": 1,
            "title": "Тестовый опрос",
            "description": "Опрос для тестирования",
            "started_at": "2022-03-18",
            "finished_at": null
        },
        "answers": [
            {
                "question": {
                    "position": 1,
                    "question_type": "Ответ текстом",
                    "main_text": "Сколько будет 2+2?",
                    "choices": []
                },
                "answer": "['4']"
            },
            {
                "question": {
                    "position": 2,
                    "question_type": "Ответ с выбором одного варианта",
                    "main_text": "Скольо будет 3*2?",
                    "choices": ["5","6","7","8"]
                },
                "answer": "['6']"
            },
            {
                "question": {
                    "position": 3,
                    "question_type": "Ответ с выбором нескольких вариантов",
                    "main_text": "Выберите нечетные числа",
                    "choices": ["4","5","10","15"]
                },
                "answer": "['5', '15']"
            }
        ]
    }
]
```